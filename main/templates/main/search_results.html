{% extends 'main/base.html' %}  <!-- Replace with your base template -->
{% load static %}
{% load my_filters %}

{% block content %}
<style>
.author-link {
    color: #005109;
    cursor: pointer;
    text-decoration: none;
    display: inline; /* Ensures authors are displayed inline */
    font-weight: 500;
    transition: color 0.3s ease;
}

.author-link:hover {
    color: #003d07;
    text-decoration: underline;
}

/* File link styling for original vs translated posts */
.original-file-link {
    color: #007bff; /* Blue for original posts */
    text-decoration: none;
    font-weight: bold;
}

.original-file-link:hover {
    color: #0056b3;
    text-decoration: underline;
}

.translated-file-link {
    color: #dc3545; /* Light red for translated posts */
    text-decoration: none;
    font-weight: bold;
}

.translated-file-link:hover {
    color: #c82333;
    text-decoration: underline;
}

.translator-link {
    color: #dc3545 !important;
    background: rgba(220, 53, 69, 0.1) !important;
}

.translator-link:hover {
    color: #c82333 !important;
    background: rgba(220, 53, 69, 0.2) !important;
}

.author-name, .translator-name {
    color:rgb(48, 105, 21);
    font-style: italic;
    font-weight: 400;
}
</style>
<div class="container">
    <h2>نتائج البحث</h2>
    {% if results %}
            {% for post in results %}
            <div class="card mt-2">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5>
                  <a href="{% url 'post_detail_by_meaningful_id' post.meaningful_id %}" style="color: inherit; text-decoration: none;">{{ post.title }}</a>
                  {% if post.pdf %}
                  <p>
                    <a href="{{ post.pdf.url }}" target="_blank"><i class="fas fa-file-pdf"></i></a>
                  </p> 
                {% endif %} 
                </h5>
              </div>
                
              <div class="card-body">
                {% if post.translator %}
                <h6 class="post-author">المؤلف الأصلي: 
                    {% with authors_list=post.authors|split:"," %}
                        {% for author in authors_list %}
                            {% with author_name=author|strip %}
                                {% if author_name|user_exists %}
                                    <a href="{% url 'find_user_by_name' author_name=author_name %}" class="author-link">{{ author_name }}</a>{% if not forloop.last %}, {% endif %}
                                {% else %}
                                    <span class="author-name">{{ author_name }}</span>{% if not forloop.last %}, {% endif %}
                                {% endif %}
                            {% endwith %}
                        {% endfor %}
                    {% endwith %}
                </h6>
                
                <p class="post-translator">المترجم: 
                    {% with translators_list=post.translator|split:"," %}
                        {% for translator in translators_list %}
                            {% with translator_name=translator|strip %}
                                {% if translator_name|user_exists %}
                                    <a href="{% url 'find_user_by_name' author_name=translator_name %}" class="author-link translator-link">{{ translator_name }}</a>{% if not forloop.last %}, {% endif %}
                                {% else %}
                                    <span class="translator-name">{{ translator_name }}</span>{% if not forloop.last %}, {% endif %}
                                {% endif %}
                            {% endwith %}
                        {% endfor %}
                    {% endwith %}
                </p>
                {% else %}
                <h6 class="post-author">المؤلف: 
                    {% with authors_list=post.authors|split:"," %}
                        {% for author in authors_list %}
                            {% with author_name=author|strip %}
                                {% if author_name|user_exists %}
                                    <a href="{% url 'find_user_by_name' author_name=author_name %}" class="author-link">{{ author_name }}</a>{% if not forloop.last %}, {% endif %}
                                {% else %}
                                    <span class="author-name">{{ author_name }}</span>{% if not forloop.last %}, {% endif %}
                                {% endif %}
                            {% endwith %}
                        {% endfor %}
                    {% endwith %}
                </h6>
                {% endif %}
                                  <p class="post-keywords">التصنيف: 
                    {% for category in post.categories.all %}
                        {{ category.name }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        غير محدد
                    {% endfor %}
                  </p>
                <p class="post-description" id="description-{{ post.id }}">
                  {{ post.description|truncatechars:200 }}
                  {% if post.description|length > 200 %}
                      <a href="{% url 'post_detail_by_meaningful_id' post.meaningful_id %}" class="see-more-btn">اقرأ المزيد</a>
                  {% endif %}
                </p>
                
                <p class="post-keywords">الكلمات المفتاحية: {{ post.keywords }}</p>
                <p class="post-views">
                  <img src="{% static 'assets/images/view.png' %}" alt="مشاهدات" style="width: 16px; height: 16px; margin-left: 5px;">
                  {{ post.get_total_view_count }} مشاهدة
                  &nbsp;&nbsp;&nbsp;
                  <i class="fas fa-comments" style="color: #28a745; margin-left: 5px;"></i>
                  {{ post.comments.count }} تعليق
                </p>
                {% if post.pdf %}
                  <p>
                    {% if post.translator %}
                      <a href="{{ post.pdf.url }}" target="_blank" class="translated-file-link">تصفح الملف</a>
                    {% else %}
                      <a href="{{ post.pdf.url }}" target="_blank" class="original-file-link">تصفح الملف</a>
                    {% endif %}
                  </p> 
                {% endif %}
              </div>
              <div class="card-footer text-muted">{{ post.created_at }}</div>
            </div>
                    
            
            {% endfor %}
      
    {% else %}
        <p>لم يتم العثور على نتائج</p>
    {% endif %}
</div>

{% endblock %}
